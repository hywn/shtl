<html>

<script src="schedule.js"></script>

<div id="scheduleBox" class="box"><div id="sbInner"><canvas id="scheduleCanvas"></div></div>

<div id="geninfo" class="box">
       <textarea id="data"></textarea>
       <table>
       <tr><td></td><td><input type="button" value="generate" onclick="gen();" /></td></tr>
       <tr><td>marginX</td><td><input id="marginX" type="text" value="50" /></td></tr>
       <tr><td>marginY</td><td><input id="marginY" type="text" value="50" /></td></tr>
       <tr><td>startHour</td><td><input id="startHour" type="text" value="8" /></td></tr>
       <tr><td>endHour</td><td><input id="endHour" type="text" value="18" /></td></tr>
       <tr><td>blockWidth</td><td><input id="blockWidth" type="text" value="100" /></td></tr>
       <tr><td>blockHeight</td><td><input id="blockHeight" type="text" value="60" /></td></tr>
       <tr><td>font</td><td><input id="font" type="text" value="12px Arial" /></td></tr>
       <tr><td>foreground</td><td><input id="foreground" type="text" value="#000" /></td></tr>
       <tr><td>background</td><td><input id="background" type="text" value="#fff" /></td></tr>
       <tr><td>guideOpacity</td><td><input id="guideOpacity" type="text" value="0.1" /></td></tr>
       <tr><td>line spacing</td><td><input id="lineHeight" type="text" value="14" /></td></tr>
       <tr><td>text padding</td><td><input id="textPadding" type="text" value="4" /></td></tr>
       <tr><td>day of week codes</td><td><input id="shortDays" type="text" value="mo,tu,we,th,fr" /></td></tr>
       <tr><td>day of week display</td><td><input id="longDays" type="text" value="Mon,Tue,Wed,Thu,Fri" /></td></tr>
       <tr><td><input type="button" value="import settings, generate" onclick="importSettings();" /></td><td><input type="button" value="append/replace settings" onclick="appendSettings();" /></td></tr>
       </table>
</div>

<style>
body { display: flex;
       flex-wrap: wrap;
       justify-content: center;
       align-items: center;
       flex-direction: row-reverse }

.box { background-color: #eee; padding: 1em; margin: 1em }

#sbInner { background-color: #fff; padding: 1em }
#scheduleBox { display: inline-block }

#geninfo { width:400px }
#data { width: 100%; height: 25em }
#geninfo table { margin: auto }
#geninfo td { padding: 0.2em }
#geninfo td:first-child { text-align: right }
</style>

<script>
var data = document.getElementById("data");

let url = new URL(window.location.href);
let srcurl = url.searchParams.get("src");

if (srcurl) // sets ui values from text
     { fetch(srcurl).then((response) => response.text()).then(text => { document.getElementById("data").value = text
                                                                        importSettings() }) }

function gen()
     { s = new ScheduleCanvas("scheduleCanvas", { marginX: getInt("marginX"),
                                                  marginY: getInt("marginY"),
                                                  startHour: getInt("startHour"),
                                                  endHour: getInt("endHour"),
                                                  blockWidth: getInt("blockWidth"),
                                                  blockHeight: getInt("blockHeight"),
                                                  foreground: getText("foreground"),
                                                  background: getText("background"),
                                                  font: getText("font"),
                                                  guideOpacity: parseFloat(getText("guideOpacity")),
                                                  lineHeight: getInt("lineHeight"),
                                                  textPadding: getInt("textPadding"),
                                                  shortDays: getText("shortDays").split(","),
                                                  longDays: getText("longDays").split(",") })
       document.querySelector("#sbInner").style.backgroundColor = s.background
       s.drawSchedule(document.getElementById("data").value) }

function importSettings()
     { for (element of document.getElementById("geninfo").querySelectorAll("input[type=text]"))
              if ((settingValue = getSetting(element.id)) != null)
                     element.value = settingValue
       gen() }

function appendSettings()
     {	let index
       if ((index = data.value.lastIndexOf("\n\nsettings:")) != -1)
              data.value = data.value.substring(0, index)
       data.value += "\n\nsettings:"
       for (element of document.getElementById("geninfo").querySelectorAll("input[type=text]"))
              document.getElementById("data").value += "\n" + element.id + "=" + element.value }

function getLine(start)
     { for (line of data.value.split("\n"))
              if (line.startsWith(start)) return line
       return null }

function getSetting(id)
     {	if ((line = getLine(id + "=")) != null)
              return line.split("=")[1]
       return null }

function getInt(id) { return parseInt(getText(id)) }
function getText(id) { return document.getElementById(id).value }
</script>

</html>
